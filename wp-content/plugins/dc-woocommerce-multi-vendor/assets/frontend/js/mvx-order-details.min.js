jQuery(function(t){var e={init:function(){t("#mvx-order-details").on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".mvx-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("click","#order_status a",this.order_status_changed).on("keyup change",".split-input :input",function(){var e=t(this).parent().prev().find(":input");e&&(""===e.val()||e.is(".match-total"))&&e.val(t(this).val()).addClass("match-total")}).on("keyup",".split-input :input",function(){t(this).removeClass("match-total")})},block:function(){t("#mvx-order-details").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#mvx-order-details").unblock()},quantity_changed:function(){var e=t(this).closest("tr.item"),n=t(this).val(),a=t(this).attr("data-qty"),o=t("input.line_total",e),i=t("input.line_subtotal",e),r=accounting.unformat(o.attr("data-total"),mvx_order_details_js_script_data.mon_decimal_point)/a;o.val(parseFloat(accounting.formatNumber(r*n,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point));var d=accounting.unformat(i.attr("data-subtotal"),mvx_order_details_js_script_data.mon_decimal_point)/a;i.val(parseFloat(accounting.formatNumber(d*n,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)),t("input.line_tax",e).each(function(){var o=t(this),i=o.data("tax_id"),r=accounting.unformat(o.attr("data-total_tax"),mvx_order_details_js_script_data.mon_decimal_point)/a,d=t('input.line_subtotal_tax[data-tax_id="'+i+'"]',e),s=accounting.unformat(d.attr("data-subtotal_tax"),mvx_order_details_js_script_data.mon_decimal_point)/a;0<r&&o.val(parseFloat(accounting.formatNumber(r*n,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)),0<s&&d.val(parseFloat(accounting.formatNumber(s*n,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point))}),t(this).trigger("quantity_changed")},order_status_changed:function(){var e=t(this).data("status"),n=t("#order_current_status").val(),a=t("#order_ID").val();if(t(this).parents(".change-status").find(".order-status-text").removeClass(function(t,e){return(e.match(/(^|\s)wc\S+/g)||[]).join(" ")}).addClass(e),n==e)return t(".change-status").removeClass("loaderOverlay"),t(".dropdown-order-statuses").removeClass("open"),!1;if("wc-cancelled"==e){if(!window.confirm(mvx_order_details_js_script_data.i18n_do_cancel))return!1}else if("wc-cancelled"==n)return!1;t(".change-status").addClass("loaderOverlay");var o={action:"mvx_order_status_changed",order_id:a,selected_status:e,security:mvx_order_details_js_script_data.grant_access_nonce};t.post(mvx_order_details_js_script_data.ajax_url,o,function(e){e&&(t(".order_status_lbl").html(""),"wc-cancelled"==e.status_key&&t(".dropdown-order-statuses").hide(),t(".order_status_lbl").html(e.status_name),t("#order_current_status").val(e.status_key),t(".change-status").removeClass("loaderOverlay"))})},refund_items:function(){return t("div.mvx-order-refund-items").slideDown(),t("div.mvx-order-data-row-toggle").not("div.mvx-order-refund-items").slideUp(),t("div.mvx-order-totals-items").slideUp(),t("#mvx-order-details").find("div.refund").show(),!1},cancel:function(){return t("div.mvx-order-data-row-toggle").not("div.mvx-order-actions").slideUp(),t("div.mvx-order-actions").slideDown(),t("div.mvx-order-totals-items").slideDown(),t("#mvx-order-details").find("div.refund").hide(),!1},refunds:{do_refund:function(){if(e.block(),window.confirm(mvx_order_details_js_script_data.i18n_do_refund)){var n=t("input#refund_amount").val(),a=t("input#refund_reason").val(),o=t("input#refunded_amount").val(),i={},r={},d={};t(".refund input.refund_order_item_qty").each(function(e,n){t(n).closest("tr").data("order_item_id")&&n.value&&(i[t(n).closest("tr").data("order_item_id")]=n.value)}),t(".refund input.refund_line_total").each(function(e,n){t(n).closest("tr").data("order_item_id")&&(r[t(n).closest("tr").data("order_item_id")]=accounting.unformat(n.value,mvx_order_details_js_script_data.mon_decimal_point))}),t(".refund input.refund_line_tax").each(function(e,n){if(t(n).closest("tr").data("order_item_id")){var a=t(n).data("tax_id");d[t(n).closest("tr").data("order_item_id")]||(d[t(n).closest("tr").data("order_item_id")]={}),d[t(n).closest("tr").data("order_item_id")][a]=accounting.unformat(n.value,mvx_order_details_js_script_data.mon_decimal_point)}});var s={action:"mvx_do_refund",order_id:mvx_order_details_js_script_data.post_id,refund_amount:n,refunded_amount:o,refund_reason:a,line_item_qtys:JSON.stringify(i,null,""),line_item_totals:JSON.stringify(r,null,""),line_item_tax_totals:JSON.stringify(d,null,""),api_refund:t(this).is(".do-api-refund"),restock_refunded_items:t("#restock_refunded_items:checked").length?"true":"false",security:mvx_order_details_js_script_data.order_item_nonce};t.post(mvx_order_details_js_script_data.ajax_url,s,function(t){!0===t.success?window.location.href=window.location.href:(window.location.href=window.location.href,e.unblock())})}else e.unblock()},input_changed:function(){var e=0;t(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping").each(function(){t(this).find(".refund input:not(.refund_order_item_qty)").each(function(n,a){e+=parseFloat(accounting.unformat(t(a).val()||0,mvx_order_details_js_script_data.mon_decimal_point))})}),t("#refund_amount").val(accounting.formatNumber(e,mvx_order_details_js_script_data.currency_format_num_decimals,"",mvx_order_details_js_script_data.mon_decimal_point)).change()},amount_changed:function(){var e=accounting.unformat(t(this).val(),mvx_order_details_js_script_data.mon_decimal_point);t("button .wc-order-refund-amount .amount").text(accounting.formatMoney(e,{symbol:mvx_order_details_js_script_data.currency_format_symbol,decimal:mvx_order_details_js_script_data.currency_format_decimal_sep,thousand:mvx_order_details_js_script_data.currency_format_thousand_sep,precision:mvx_order_details_js_script_data.currency_format_num_decimals,format:mvx_order_details_js_script_data.currency_format}))},refund_quantity_changed:function(){var e=t(this).closest("tr.item"),n=e.find("input.quantity").val(),a=t(this).val(),o=t("input.line_total",e),i=t("input.refund_line_total",e),r=accounting.unformat(o.attr("data-total"),mvx_order_details_js_script_data.mon_decimal_point)/n;i.val(parseFloat(accounting.formatNumber(r*a,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)).change(),t(".refund_line_tax",e).each(function(){var o=t(this),i=t('input.line_tax[data-tax_id="'+o.data("tax_id")+'"]',e),r=accounting.unformat(i.data("total_tax"),mvx_order_details_js_script_data.mon_decimal_point)/n;0<r?o.val(parseFloat(accounting.formatNumber(r*a,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)).change():o.val(0).change()}),a>0?t("#restock_refunded_items").closest("tr").show():(t("#restock_refunded_items").closest("tr").hide(),t(".woocommerce_order_items input.refund_order_item_qty").each(function(){t(this).val()>0&&t("#restock_refunded_items").closest("tr").show()})),t(this).trigger("refund_quantity_changed")}}};e.init(),({init:function(){t(".date-picker").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),t(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access).on("click","#copy-download-link",this.copy_link).on("aftercopy","#copy-download-link",this.copy_success).on("aftercopyfailure","#copy-download-link",this.copy_fail)},grant_access:function(){var e=t("#grant_access_id").val();if(e){t(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={action:"mvx_grant_access_to_download",product_ids:e,loop:t(".order_download_permissions .wc-metabox").length,order_id:mvx_order_details_js_script_data.post_id,security:mvx_order_details_js_script_data.grant_access_nonce};return t.post(mvx_order_details_js_script_data.ajax_url,n,function(e){e?t(".order_download_permissions .wc-metaboxes").append(e):window.alert(mvx_order_details_js_script_data.i18n_download_permission_fail),t(document.body).trigger("wc-init-datepickers"),t("#grant_access_id").val("").change(),t(".order_download_permissions").unblock()}),!1}},revoke_access:function(){if(window.confirm(mvx_order_details_js_script_data.i18n_permission_revoke)){var e=t(this).parent().parent(),n=t(this).attr("rel").split(",")[0],a=t(this).attr("rel").split(",")[1],o=t(this).data("permission_id");if(n>0){t(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var i={action:"woocommerce_revoke_access_to_download",product_id:n,download_id:a,permission_id:o,order_id:mvx_order_details_js_script_data.post_id,security:mvx_order_details_js_script_data.revoke_access_nonce};t.post(mvx_order_details_js_script_data.ajax_url,i,function(){t(e).fadeOut("300",function(){t(e).remove()})})}else t(e).fadeOut("300",function(){t(e).remove()})}return!1},copy_link:function(e){wcClearClipboard(),wcSetClipboard(t(this).attr("href"),t(this)),e.preventDefault()},copy_success:function(){t(this).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()},copy_fail:function(){t(this).tipTip({attribute:"data-tip-failed",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()}}).init()});